<!doctype html>

<head>
  <meta charset='utf8'>
  <link rel='icon' href='data:,'>
  <title>Animate</title>
  <style>
    canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      cursor: grab;
    }
  </style>
  <script type='module' defer>

    import * as THREE from '//cdn.skypack.dev/three@0.132?min'
    import { OrbitControls } from '//cdn.skypack.dev/three@0.132/examples/jsm/controls/OrbitControls?min'
    import { Strip } from '../../build/three-strip.js'

    const renderer = new THREE.WebGLRenderer();
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, 2, .1, 100);
    const controls = new OrbitControls(camera, renderer.domElement);

    scene.background = new THREE.Color('white');
    camera.position.set(0, 2, 2);
    controls.enableDamping = true;

    const light = new THREE.DirectionalLight();
    scene.add(light);

    scene.add(new THREE.GridHelper());

    // ----
    // Strip
    // ----

    Strip.THREE = THREE;

    const curve = new THREE.CatmullRomCurve3([
      new THREE.Vector3(-1, 0, 0),
      new THREE.Vector3(0, 1, 0),
      new THREE.Vector3(1, 0, 0),
    ]);
    const strip = new Strip(curve, 200, 0.5, 0, Strip.UvFns[0]);
    
    const map = new THREE.TextureLoader().load('../img/a.jpg');
    const mat = new THREE.MeshLambertMaterial({ side: THREE.DoubleSide, map });
    const mesh = new THREE.Mesh(strip.geometry, mat);
    scene.add(mesh);

    // ----
    // render
    // ----

    renderer.setAnimationLoop((t) => {
      renderer.render(scene, camera);
      controls.update();
      t = Math.sin(t / 1e3) * .5 + .5; // 0 to 1

      // Setting props in one go by `setProps()` is performant
      strip.setProps(
        undefined,
        undefined,
        (i, I) => .2 + (1 - t) * .3, // .2 to .5
        (i, I) => i / I * Math.PI * 4 * t, // 2 turns
        undefined
      );
    });

    // ----
    // view
    // ----

    function resize(w, h, dpr = devicePixelRatio) {
      renderer.setPixelRatio(dpr);
      renderer.setSize(w, h, false);
      camera.aspect = w / h;
      camera.updateProjectionMatrix();
    }
    addEventListener('resize', () => resize(innerWidth, innerHeight));
    dispatchEvent(new Event('resize'));
    document.body.prepend(renderer.domElement);

  </script>
</head>

<body></body>